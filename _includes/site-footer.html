<footer class="footer">
  <div class="container">
    <div class="copyright  typeset">
      <small class="small">&copy; {{ site.title }} {{ site.time | date: '%Y' }}</small>
    </div>

    {% include nav-footer.html %}
  </div>
</footer>

    <!-- G-Translate 翻译浮动条控制逻辑 -->
    <div id="gtranslate-block-container">
      <div class="gtranslate_wrapper"></div>
      <script>
        // G-Translate 设置 - 确保它们在脚本加载前定义
        window.gtranslateSettings = {
          "default_language": "zh-CN",
          "detect_browser_language": true, // 保持为 true，以便 G-Translate 首次加载时检测
          "languages": ["zh-CN", "zh-TW", "th", "en"],
          "wrapper_selector": ".gtranslate_wrapper"
        };
        
        // 动态创建并加载 G-Translate 脚本。
        // 由于我们将始终控制其可见性，所以脚本本身需要加载。
        const gTranslateScript = document.createElement('script');
        gTranslateScript.src = "https://cdn.gtranslate.net/widgets/latest/float.js";
        gTranslateScript.defer = true; // 延迟加载，不阻塞页面渲染
        document.getElementById('gtranslate-block-container').appendChild(gTranslateScript);

        // 获取 G-Translate 包装器元素
        const gTranslateWrapper = document.querySelector('.gtranslate_wrapper');

        // 在脚本加载后立即运行的函数，因为 gTranslateWrapper 可能还没有完全初始化
        gTranslateScript.onload = () => {
            // 获取浏览器首选语言
            const browserLangIsZhCn = navigator.language.startsWith('zh-CN');
            // 从 localStorage 读取用户是否手动设置了浮动条的可见性
            // 'visible' 表示用户希望它显示，'hidden' 表示用户希望它隐藏
            const userOverride = localStorage.getItem('gTranslateOverrideVisibility');

            let initialDisplay = 'none'; // 默认情况下，先隐藏浮动条

            if (userOverride === 'visible') {
                initialDisplay = 'block'; // 用户明确设置为显示
            } else if (userOverride === 'hidden') {
                initialDisplay = 'none'; // 用户明确设置为隐藏
            } else if (!browserLangIsZhCn) {
                // 如果没有用户偏好，且浏览器语言不是简体中文，则默认显示
                initialDisplay = 'block';
            }
            // 否则（浏览器语言是简体中文且无用户偏好），保持为 'none'

            gTranslateWrapper.style.display = initialDisplay;
        };


        /**
         * 全局函数：用于切换 G-Translate 浮动条的可见性。
         * 每次切换时，都会将用户的选择存储到 localStorage。
         */
        window.toggleGTranslateVisibility = function() {
          const currentDisplay = gTranslateWrapper.style.display;

          if (currentDisplay === 'none') {
            gTranslateWrapper.style.display = 'block';
            // 用户点击了显示，所以保存偏好为 'visible'
            localStorage.setItem('gTranslateOverrideVisibility', 'visible');
          } else {
            gTranslateWrapper.style.display = 'none';
            // 用户点击了隐藏，所以保存偏好为 'hidden'
            localStorage.setItem('gTranslateOverrideVisibility', 'hidden');
          }
        };
      </script>
    </div>
    <!-- G-Translate 翻译浮动条控制逻辑 结束 -->

    {% include theme-dark-mode.html %}