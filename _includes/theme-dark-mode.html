<!-- HTML, CSS 和 JavaScript 代码 -->

<!-- 1. 必要的 CSS 样式 -->
<style>
  /* 强制隐藏 darkmode.js 库自带的浮动按钮 */
  .darkmode-toggle {
    display: none !important;
  }

  /* 自定义切换按钮的容器样式 */
  #custom-darkmode-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    padding: 0;
    background-color: transparent;
    border: none;
    cursor: pointer;
    /* 让SVG图标颜色继承当前文本颜色，以便更好地适应您的主题 */
    color: inherit; 
  }

  #custom-darkmode-toggle svg {
    width: 100%;
    height: 100%;
    fill: currentColor; /* 使用 currentColor 继承父元素的 color 属性 */
  }

  /* 默认状态下（亮色模式），显示太阳，隐藏月亮 */
  .sun-icon {
    display: block;
  }
  .moon-icon {
    display: none;
  }

  /* 当 body 有 .darkmode--activated 类时（暗色模式），隐藏太阳，显示月亮 */
  .darkmode--activated .sun-icon {
    display: none;
  }
  .darkmode--activated .moon-icon {
    display: block;
  }
</style>

<!-- 2. 引入 darkmode.min.js 库 -->
<!-- 请确保这里的路径是正确的 -->
<script src="/assets/darkmode-js.min.js"></script>

<!-- 3. 初始化和控制逻辑 -->
<script>
  // 等待文档完全加载
  document.addEventListener('DOMContentLoaded', function () {
    
    // (1) 定义 darkmode.js 的初始化参数
    const options = {
      saveInCookies: true,       // 保存用户选择到 cookie
      autoMatchOsTheme: false,   // 不自动匹配操作系统主题
      label: '🌓' // 这个标签虽然不会显示，但库内部可能需要
    };

    // (2) 初始化 darkmode 实例
    const darkmode = new Darkmode(options);

    // 注意：我们 **不** 调用 darkmode.showWidget()，因为我们不想显示默认的浮动按钮。
    // 我们将手动控制切换功能。

    // (3) 获取您在 header 中设置的占位符元素
    const placeholder = document.getElementById('darkmode-placeholder');

    if (placeholder) {
      // (4) 创建并注入我们的自定义 SVG 按钮
      const toggleButtonHTML = `
        <button id="custom-darkmode-toggle" aria-label="Toggle dark mode">
          <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22px" height="22px">
            <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM12 15c-1.65 0-3-1.35-3-3s1.35-3 3-3 3 1.35 3 3-1.35 3-3 3zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM1 11h2v2H1zM21 11h2v2h-2zM11 1v2h2V1zM11 21v2h2v-2zM4.22 4.22l1.42 1.42 1.41-1.41L5.63 2.81zM18.36 18.36l-1.42-1.42-1.41 1.41 1.41 1.42zM2.81 18.36l1.41-1.41 1.42 1.42L4.22 19.78zM19.78 4.22l-1.41 1.42-1.42-1.42 1.42-1.41z"/>
          </svg>
          <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="22px" height="22px">
            <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.62-.11 2.36-.31-3.12-.99-5.36-3.95-5.36-7.44 0-4.24 3.42-7.66 7.66-7.66.39 0 .78.04 1.15.11C16.88 3.63 14.54 3 12 3z"/>
          </svg>
        </button>
      `;
      placeholder.innerHTML = toggleButtonHTML;

      // (5) 为我们新创建的按钮添加点击事件监听器
      const toggleButton = document.getElementById('custom-darkmode-toggle');
      if (toggleButton) {
        toggleButton.addEventListener('click', function() {
          darkmode.toggle(); // 调用库的切换方法
        });
      }
    } else {
      console.warn('Darkmode placeholder with ID "darkmode-placeholder" was not found.');
    }
  });
</script>