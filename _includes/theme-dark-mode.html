<!-- ========== 方案三：Nightowl (手动实现) ========== -->

<!-- CSS样式：用于颜色反转和效果优化 -->
<style>
  /* 当body标签含有 nightowl-dark 类时，激活暗黑模式 */
  body.nightowl-dark {
    filter: invert(1) hue-rotate(180deg);
  }

  /* 修正图片和视频的反转问题 */
  body.nightowl-dark img,
  body.nightowl-dark video,
  body.nightowl-dark iframe {
    filter: invert(1) hue-rotate(180deg);
  }
</style>

<!-- 引入Nightowl库 -->
<script src="https://cdn.jsdelivr.net/npm/@bufferhead/nightowl@0.0.12/dist/nightowl.js" type="module"></script>

<!-- 自定义逻辑以适配您的需求 -->
<script type="module">
  // 导入库的创建函数
  import { createNightowl } from 'https://cdn.jsdelivr.net/npm/@bufferhead/nightowl@0.0.12/dist/nightowl.js';

  // 初始化Nightowl，但不要让它创建自己的按钮
  createNightowl({
    toggleButtonMode: 'none' // 假设有此选项或通过不调用某个方法来避免
  });
  
  // 获取您的开关元素和body元素
  const switchButton = document.getElementById('darkmode-switch');
  const body = document.body;

  // 页面加载时，检查sessionStorage
  // 以恢复用户在当前会话中的选择
  if (sessionStorage.getItem('theme') === 'dark') {
    body.classList.add('nightowl-dark');
  }
  
  // 为您的开关添加点击事件
  switchButton.addEventListener('click', function(event) {
    // 阻止<a>标签的默认跳转行为
    event.preventDefault(); 
    
    // 手动切换 'nightowl-dark' 类
    body.classList.toggle('nightowl-dark');
    
    // 根据当前状态更新sessionStorage
    if (body.classList.contains('nightowl-dark')) {
      sessionStorage.setItem('theme', 'dark');
    } else {
      sessionStorage.setItem('theme', 'light');
    }
  });
</script>