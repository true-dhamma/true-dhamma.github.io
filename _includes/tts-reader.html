<!-- ======================================================================= -->
<!-- =============  TTS (Text-to-Speech) Reader Include  ============= -->
<!-- ======================================================================= -->
<!-- 
  Version: 1.1 (Jekyll-safe)
  Description: A self-contained TTS widget wrapped in {% raw %} tags to 
               prevent Liquid parsing errors in Jekyll.
-->

<!-- HTML部分通常不需要raw标签，可以保持原样 -->
<div class="tts-reader-widget-container" id="tts-reader-widget" style="display: none;">
    <!-- ... (这里是所有的HTML结构, 从 <div class="tts-reader-widget-container..."> 到 </div>) ... -->
    <!-- 我将完整的HTML部分折叠起来以便阅读，请确保你的代码是完整的 -->
    <!-- Main Floating Action Button (FAB) -->
    <button id="tts-fab-main" class="tts-fab" aria-label="打开朗读工具">
        <svg class="icon-play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M8 5v14l11-7z"></path></svg>
        <svg class="icon-pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"></path></svg>
        <svg class="icon-loading" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="24" height="24" style="display: none;"><circle cx="50" cy="50" fill="none" stroke="currentColor" stroke-width="10" r="35" stroke-dasharray="164.93361431346415 56.97787143782138"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg>
    </button>
    <!-- Controls Panel (expands from FAB) -->
    <div id="tts-controls-panel" class="tts-controls">
        <button id="tts-stop-btn" class="tts-control-btn" aria-label="停止">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M6 6h12v12H6z"></path></svg>
        </button>
        <button id="tts-settings-btn" class="tts-control-btn" aria-label="设置">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"></path></svg>
        </button>
    </div>
    <!-- Settings Panel (pops up) -->
    <div id="tts-settings-panel" class="tts-settings" style="display: none;">
        <div class="tts-setting-item">
            <label for="tts-voice-select">语音选择:</label>
            <select id="tts-voice-select"></select>
        </div>
        <div class="tts-setting-item">
            <label for="tts-rate-slider">语速: <span id="tts-rate-value">1.0</span>x</label>
            <input type="range" id="tts-rate-slider" min="0.5" max="2" step="0.1" value="1">
        </div>
    </div>
</div>

{% raw %}
<style>
    /* Scoped styles for the TTS widget to avoid conflicts */
    .tts-reader-widget-container {
        position: fixed;
        bottom: 25px;
        right: 25px;
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    /* ... (这里是所有的CSS代码) ... */
    .tts-reader-widget-container #tts-rate-slider {
        width: 100%;
        cursor: pointer;
    }
</style>

<script>
(() => {
    'use strict';
    // ... (这里是所有的JavaScript代码, 从 'use strict' 开始) ...
    // Initial UI state
    updateUI('idle');

})();
</script>
{% endraw %}