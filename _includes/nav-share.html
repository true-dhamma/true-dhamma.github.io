<div class="share">
  {% comment %} Original sharing links loop - Exclude PageShare from this loop {% endcomment %}
  {% for network in site.sharing_links %}
    {% if network[1] != blank and network[0] != "PageShare" %}
      {% assign name = network[0] %}
      {% assign id = network[0] | downcase | remove: " " %}
      {% assign url = site.url | append: site.baseurl | append: page.url %}
      {% assign color = network[1] %}

      {% capture share_link %}
        {%- if id contains "twitter" %}https://twitter.com/intent/tweet/?url={{ url }}&text={{ page.title | uri_escape }}{% if site.twitter.username %}&via={{ site.twitter.username }}{% endif %}{% endif -%}
        {%- if id contains "facebook" %}https://facebook.com/sharer/sharer.php?u={{ url }}{% endif -%}
        {%- if id contains "pinterest" %}https://pinterest.com/pin/create/button/?url={{ url }}&description={{ page.title }}&media={{ page.image }}{% endif -%}
        {%- if id contains "linkedin" %}https://www.linkedin.com/shareArticle?url={{ url }}&title={{ page.title }}&source={{ site.title }}&mini=true{% endif -%}
        {%- if id contains "tumblr" %}https://tumblr.com/widgets/share/tool?canonicalUrl={{ url }}&tags={{ page.category }}&caption={{ page.title }}{% endif -%}
        {%- if id contains "reddit" %}https://reddit.com/submit?url={{ url }}&title={{ page.title }}&resubmit=true{% endif -%}
        {%- if id contains "hackernews" %}https://news.ycombinator.com/submitlink?u={{ url }}&t={{ page.title }}{% endif -%}
        {%- if id contains "designernews" %}https://www.designernews.co/submit?url={{ url }}&title={{ page.title }}{% endif -%}
        {%- if id contains "email" %}mailto:?subject={{ page.title }}&body={{ url | prepend: "Hey, check out this: "}}{% endif -%}
      {% endcapture %}

      {% include button.html text=name icon=id link=share_link color=color %}
    {% endif %}
  {% endfor %}

  {% comment %} Custom Page Share Button - 页面分享按钮 {% endcomment %}
  {% if site.sharing_links.PageShare %}
    {% assign current_url = site.url | append: site.baseurl | append: page.url %}
    {% assign page_title = page.title | default: site.title %}

    <style>
      /* 二维码弹窗的CSS样式 */
      .qrcode-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none; /* 默认隐藏 */
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .qrcode-container {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-align: center;
        max-width: 90%; /* 适应小屏幕 */
        box-sizing: border-box;
      }
      .qrcode-container img {
        display: block;
        margin: 0 auto 15px auto; /* 增加底部间距 */
        max-width: 100%; /* 确保图片不会溢出容器 */
        height: auto; /* 保持图片比例 */
      }
      .qrcode-container p {
        margin-bottom: 15px; /* 增加底部间距 */
        color: #333;
        font-size: 1.1em; /* 稍微增大字体 */
        word-break: break-all; /* 防止长URL溢出 */
      }
      .qrcode-container .close-button {
        background-color: #f44336;
        color: white;
        border: none;
        padding: 10px 20px; /* 增大点击区域 */
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px; /* 增大字体 */
        cursor: pointer;
        border-radius: 5px; /* 稍微圆角 */
        transition: background-color 0.3s ease; /* 添加过渡效果 */
      }
      .qrcode-container .close-button:hover {
        background-color: #d32f2f; /* 鼠标悬停时的颜色 */
      }
    </style>

    <div id="pageShareButtonContainer">
      {% comment %}
        使用button.html生成分享按钮。
        link="#"表示点击后由JavaScript处理，避免页面跳转。
        id="pageShareButton"用于JavaScript定位元素。
        icon="link"使用site-icons.svg中已有的链接图标。
      {% endcomment %}
      {% include button.html text="分享" icon="link" link="#" id="pageShareButton" %}
    </div>

    {% comment %} 二维码显示弹窗 {% endcomment %}
    <div class="qrcode-overlay" id="qrcodeOverlay">
      <div class="qrcode-container">
        <p>请扫描二维码分享此页面:</p>
        <div id="qrcodeImageContainer"></div>
        <p class="share-url">{{ current_url }}</p>
        <button class="close-button" id="closeQrcode">关闭</button>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const shareButton = document.getElementById('pageShareButton');
        const qrcodeOverlay = document.getElementById('qrcodeOverlay');
        const qrcodeImageContainer = document.getElementById('qrcodeImageContainer');
        const closeQrcodeButton = document.getElementById('closeQrcode');

        const pageUrl = "{{ current_url }}";
        const pageTitle = "{{ page_title }}";

        shareButton.addEventListener('click', function(event) {
          event.preventDefault(); // 阻止按钮的默认跳转行为

          // 判断是否支持 Web Share API (通常在移动设备上支持)
          if (navigator.share) {
            // 移动端：调用浏览器原生分享API
            navigator.share({
                title: pageTitle,
                url: pageUrl
              })
              .then(() => console.log('页面分享成功'))
              .catch((error) => console.log('分享失败或取消:', error));
          } else {
            // PC端：显示二维码
            qrcodeImageContainer.innerHTML = ''; // 清空可能存在的旧二维码
            // 使用 api.qrserver.com 生成二维码图片，轻量且无需引入额外库
            const qrCodeImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(pageUrl)}`;
            const qrCodeImg = document.createElement('img');
            qrCodeImg.src = qrCodeImageUrl;
            qrCodeImg.alt = '扫描二维码分享此页面';
            qrcodeImageContainer.appendChild(qrCodeImg);

            qrcodeOverlay.style.display = 'flex'; // 显示二维码弹窗
          }
        });

        // 关闭二维码弹窗按钮事件
        closeQrcodeButton.addEventListener('click', function() {
          qrcodeOverlay.style.display = 'none'; // 隐藏弹窗
        });

        // 点击弹窗背景时关闭弹窗
        qrcodeOverlay.addEventListener('click', function(event) {
          if (event.target === qrcodeOverlay) {
            qrcodeOverlay.style.display = 'none';
          }
        });
      });
    </script>
  {% endif %}
</div>