---
layout: default
---

{% include site-header.html %}

<main class="main  container">

  <article class="article  article--post  content  typeset">
    
    <h1>{{ page.title }}</h1>
    {% include post-meta.html %}
    {{ content }}

    {% include nav-share.html %}

    {% include post-comments.html %}

  </article>

  {% if page.aside == true %}{% include site-aside.html %}{% endif %}

</main>


<!-- =================================================================== -->
<!-- ==============  开始：自动生成文章目录 (TOC) 的脚本 (嵌套列表版)  ============== -->
<!-- =================================================================== -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    const content = document.querySelector('.article--post');
    const tocContainer = document.getElementById('toc-container');
    const tocNav = document.getElementById('toc-nav');
    const relatedPostsContainer = document.getElementById('related-posts-container');

    if (!tocContainer || !relatedPostsContainer) {
      return;
    }

    const headings = content.querySelectorAll('h2, h3');

    if (headings.length === 0) {
      return;
    }

    // 创建最外层的 ul 列表
    const tocList = document.createElement('ul');
    tocList.className = 'list list--categories'; // 复用主题的基础列表样式

    let lastH2ListItem = null; // 用来追踪最后一个 H2 的列表项
    let sublist = null;        // 用来追踪 H2 下的嵌套 ul 列表

    headings.forEach(heading => {
      // 确保标题有 Kramdown 自动生成的 id
      if (!heading.id) { return; }

      const tagName = heading.tagName.toLowerCase();
      
      if (tagName === 'h2') {
        // 创建 H2 的列表项 <li>
        const listItem = document.createElement('li');
        listItem.className = 'item item--category'; // 使用主题的顶层列表项样式

        const link = document.createElement('a');
        link.href = '#' + heading.id;
        link.textContent = heading.textContent;
        
        listItem.appendChild(link);
        tocList.appendChild(listItem); // 将 H2 项添加到主列表

        // 更新追踪变量
        lastH2ListItem = listItem; 
        sublist = null; // 重置 sublist，因为这是一个新的 H2 section

      } else if (tagName === 'h3') {
        // 只有在当前有 H2 的情况下才创建嵌套列表
        if (lastH2ListItem) {
          // 如果这个 H2 下的 <ul> 还没创建，就创建一个
          if (!sublist) {
            sublist = document.createElement('ul');
            lastH2ListItem.appendChild(sublist); // 把 <ul> 嵌套进 H2 的 <li> 里
          }
          
          // 创建 H3 的列表项 <li>
          const subListItem = document.createElement('li');
          // 注意：子列表项通常不需要和父项一样的 class，以避免不必要的样式
          
          const link = document.createElement('a');
          link.href = '#' + heading.id;
          link.textContent = heading.textContent;

          subListItem.appendChild(link);
          sublist.appendChild(subListItem); // 将 H3 项添加到嵌套的 <ul> 中
        }
      }
    });

    // 将生成好的完整目录列表放入导航容器
    tocNav.appendChild(tocList);

    // 显示目录，隐藏相关文章
    tocContainer.style.display = 'block';
    relatedPostsContainer.style.display = 'none';
  });
</script>
<!-- =================================================================== -->
<!-- ==============   结束：自动生成文章目录 (TOC) 的脚本  ============== -->
<!-- =================================================================== -->

{% include tts-reader.html %}
{% include site-footer.html %}
