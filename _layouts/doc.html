---
layout: default
---

{%- comment %} --- Data Preparation --- {% endcomment %}
{%- assign collection_name = page.collection -%}
{%- assign doc_data = site.data.docs[collection_name] -%}
{%- assign doc_title = doc_data.title | default: collection_name | capitalize -%}
{%- assign doc_chapters = doc_data.chapters -%}
{%- assign page_title_from_data = "" -%}
{%- for chapter in doc_chapters -%}{%- if chapter.url == page.url -%}{%- assign page_title_from_data = chapter.title -%}{% break %}{% endif -%}{%- if chapter.subitems -%}{%- for subitem in chapter.subitems -%}{%- if subitem.url == page.url -%}{%- assign page_title_from_data = subitem.title -%}{% break %}{% endif -%}{%- if subitem.subitems -%}{%- for subsubitem in subitem.subitems -%}{%- if subsubitem.url == page.url -%}{%- assign page_title_from_data = subsubitem.title -%}{% break %}{% endif -%}{%- if subsubitem.subitems -%}{%- for subsubsubitem in subsubitem.subitems -%}{%- if subsubsubitem.url == page.url -%}{%- assign page_title_from_data = subsubsubitem.title -%}{% break %}{% endif -%}{%- endfor -%}{%- if page_title_from_data != "" %}{% break %}{% endif %}{%- endif -%}{%- endfor -%}{%- if page_title_from_data != "" %}{% break %}{% endif %}{%- endif -%}{%- endfor -%}{%- if page_title_from_data != "" %}{% break %}{% endif %}{%- endif -%}{%- endfor -%}
{%- assign page_title_to_display = page_title_from_data | default: page.title | default: "Untitled" -%}

{%- comment %}
  --- MODIFICATION STARTS HERE: Define the new condition for showing TOC ---
  The variable 'show_toc' will be true only if:
  1. The page's frontmatter has `toc: true`.
  2. The rendered page content actually contains at least one h2, h3, or h4 tag.
{% endcomment -%}
{%- assign content_has_headings = false -%}
{%- if content contains "<h2" or content contains "<h3" or content contains "<h4" -%}
  {%- assign content_has_headings = true -%}
{%- endif -%}
{%- assign show_toc = false -%}
{%- if page.toc and content_has_headings -%}
  {%- assign show_toc = true -%}
{%- endif -%}
{%- comment %} --- MODIFICATION ENDS HERE --- {% endcomment -%}

{%- capture nav_list_html %}
<ul class="doc-nav-list doc-nav-list--l1">
  {%- for item_l1 in doc_chapters %}
  <li class="doc-nav-item doc-nav-item--l1 {% if page.url == item_l1.url %}active{% endif %}" data-level="1" {% if item_l1.subitems %}data-url="{{ item_l1.url | relative_url }}"{% endif %}>
    
    <div class="doc-nav-item-content-wrapper {% if item_l1.subitems %}has-submenu{% endif %}">
      <a href="{{ item_l1.url | relative_url }}#doc-content" class="doc-nav-link">{{ item_l1.title }}</a>
      {%- if item_l1.subitems %}
      <div class="doc-nav-toggle-wrapper">
        <span class="doc-nav-toggle"></span>
      </div>
      {%- endif %}
    </div>

    {%- if item_l1.subitems %}
    <ul class="doc-nav-list doc-nav-list--l2">
      {%- for item_l2 in item_l1.subitems %}
      <li class="doc-nav-item doc-nav-item--l2 {% if page.url == item_l2.url %}active{% endif %}" data-level="2" {% if item_l2.subitems %}data-url="{{ item_l2.url | relative_url }}"{% endif %}>
        
        <div class="doc-nav-item-content-wrapper {% if item_l2.subitems %}has-submenu{% endif %}">
          <a href="{{ item_l2.url | relative_url }}#doc-content" class="doc-nav-link">{{ item_l2.title }}</a>
          {%- if item_l2.subitems %}
          <div class="doc-nav-toggle-wrapper">
            <span class="doc-nav-toggle"></span>
          </div>
          {%- endif %}
        </div>

        {%- if item_l2.subitems %}
        <ul class="doc-nav-list doc-nav-list--l3">
          {%- for item_l3 in item_l2.subitems %}
          <li class="doc-nav-item doc-nav-item--l3 {% if page.url == item_l3.url %}active{% endif %}" data-level="3" {% if item_l3.subitems %}data-url="{{ item_l3.url | relative_url }}"{% endif %}>

            <div class="doc-nav-item-content-wrapper {% if item_l3.subitems %}has-submenu{% endif %}">
              <a href="{{ item_l3.url | relative_url }}#doc-content" class="doc-nav-link">{{ item_l3.title }}</a>
              {%- if item_l3.subitems %}
              <div class="doc-nav-toggle-wrapper">
                <span class="doc-nav-toggle"></span>
              </div>
              {%- endif %}
            </div>

            {%- if item_l3.subitems %}
            <ul class="doc-nav-list doc-nav-list--l4">
              {%- for item_l4 in item_l3.subitems %}
              <li class="doc-nav-item doc-nav-item--l4 {% if page.url == item_l4.url %}active{% endif %}" data-level="4">
                <a href="{{ item_l4.url | relative_url }}#doc-content" class="doc-nav-link">{{ item_l4.title }}</a>
              </li>
              {%- endfor %}
            </ul>
            {%- endif %}
          </li>
          {%- endfor %}
        </ul>
        {%- endif %}
      </li>
      {%- endfor %}
    </ul>
    {%- endif %}
  </li>
  {%- endfor %}
</ul>
{%- endcapture %}

<style>
  /* --- All CSS styles remain unchanged --- */
  /* --- Base Doc Layout (unchanged) --- */
  @media screen and (min-width: 768px) {
    .main.container--doc { display: flex; gap: 2em; max-width: 960px; margin: 0 auto; align-items: flex-start; }
    .article--doc { flex: 1 1 auto; min-width: 0; }
  }
  @media screen and (min-width: 1200px) {
    .main.container--doc { max-width: 1440px; gap: 2.5em; justify-content: center; }
    .article--doc { flex-grow: 1; flex-basis: auto; max-width: 800px; }
    .main.container--doc .content-toc-right-wrapper { 
      flex: 0 0 260px; 
      position: sticky; 
      top: 2rem; 
      max-height: calc(100vh - 4rem);
      overflow-y: auto;
    }
  }

  .placeholder-toc {
    display: none;
  }

  @media screen and (min-width: 1800px) {
    .main.container--doc { max-width: 2200px; width: 90%; justify-content: space-between; }
    .article--doc { flex: 0 0 800px; }
    .main.container--doc .content-toc-right-wrapper { flex: 0 0 280px; }
    
    .main.container--doc:not(.has-right-toc) .placeholder-toc {
      display: block;
      flex: 0 0 280px;
      content: '';
    }
  }
  
  /* --- Doc Navigation System Styles (unchanged) --- */
  body.doc-nav-open { overflow: hidden; }
  #doc-content { scroll-margin-top: 2rem; }
  .doc-nav-fab { position: fixed; bottom: 30px; left: 30px; width: 56px; height: 56px; background-color: #2c3e50; color: white; border-radius: 50%; border: none; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 1001; transition: transform 0.2s ease-in-out; }
  .doc-nav-fab:hover { transform: scale(1.1); }
  .doc-nav-fab svg { width: 24px; height: 24px; fill: currentColor; }
  .doc-nav-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s; z-index: 1002; }
  .doc-nav-container { position: fixed; top: 0; left: 0; width: 300px; height: var(--doc-nav-dynamic-height, 100vh); background-color: #fff; box-shadow: 4px 0 15px rgba(0,0,0,0.1); transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1003; display: flex; flex-direction: column; }
  body.doc-nav-open .doc-nav-container { transform: translateX(0); }
  body.doc-nav-open .doc-nav-overlay { opacity: 1; visibility: visible; }
  .doc-nav-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.5rem 1rem 15px; border-bottom: 1px solid #e9ecef; flex-shrink: 0; }
  .doc-nav-title { font-size: 1.2em; font-weight: 600; margin: 0; color: #343a40; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .doc-nav-close { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: none; background: transparent; cursor: pointer; color: #6c757d; }
  .doc-nav-close svg { width: 20px; height: 20px; }
  .doc-nav-scroll-area { flex-grow: 1; overflow-y: auto; padding: 1rem 0; -webkit-overflow-scrolling: touch; }
  .doc-nav-list { list-style: none; margin: 0; padding: 0; }
  .doc-nav-list .doc-nav-list { padding-left: 0.6em; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
  .doc-nav-item.is-expanded > .doc-nav-list { max-height: 2000px; }
  .doc-nav-item { position: relative; }
  .doc-nav-item-content-wrapper { display: flex; justify-content: space-between; align-items: center; }
  .doc-nav-link { display: block; font-size: 0.9em; color: #495057; text-decoration: none; padding: 8px 12px; border-left: 3px solid transparent; transition: all 0.2s ease; flex-grow: 1; min-width: 0; }
  .has-submenu .doc-nav-link { padding-right: 6px; }
  .doc-nav-toggle-wrapper { flex-shrink: 0; display: flex; align-items: center; justify-content: center; width: 40px; align-self: stretch; cursor: pointer; }
  .doc-nav-toggle { position: static; width: auto; height: auto; display: flex; align-items: center; justify-content: center; color: #6c757d; }
  .doc-nav-item:not(.active) .doc-nav-item-content-wrapper:hover { background-color: #f8f9fa; }
  .doc-nav-item:not(.active) .doc-nav-item-content-wrapper:hover .doc-nav-link { color: #0056b3; border-left-color: #dee2e6; }
  .doc-nav-item.active > .doc-nav-item-content-wrapper > .doc-nav-link { color: #0056b3; font-weight: 600; background-color: #e7f1ff; border-left-color: #0056b3; }
  .doc-nav-item.active > .doc-nav-item-content-wrapper { background-color: #e7f1ff; }
  .doc-nav-toggle::before { content: ''; width: 0; height: 0; border: solid currentColor; border-width: 0 1.5px 1.5px 0; display: inline-block; padding: 3px; transform: rotate(45deg); transition: transform 0.2s ease-in-out; }
  .doc-nav-item.is-expanded > .doc-nav-item-content-wrapper .doc-nav-toggle::before { transform: rotate(-135deg); margin-top: -4px; }
  @media screen and (min-width: 768px) { .doc-nav-fab, .doc-nav-overlay, .doc-nav-close { display: none; } .doc-nav-container { position: sticky; top: 2rem; width: auto; height: auto; transform: none; box-shadow: none; z-index: 1; max-height: calc(100vh - 4rem); display: flex; flex-direction: column; flex: 0 0 260px; } .doc-nav-header { padding: 0 0 1rem 0; border-bottom: 1px solid #e9ecef; } .doc-nav-scroll-area { padding: 1rem 0 0 0; } }
  @media screen and (min-width: 1200px) { .doc-nav-container { flex-basis: 280px; } }
  @media screen and (min-width: 1800px) { .doc-nav-container { flex-basis: 300px; } }
</style>

{% include site-header.html %}
<div class="doc-nav-overlay"></div>
<button class="doc-nav-fab" aria-label="Open documentation navigation">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</button>

<!-- MODIFICATION HERE: Use `show_toc` instead of `page.toc` -->
<main class="main container container--doc layout-doc {% if show_toc %}has-right-toc{% endif %}">
  <aside class="doc-nav-container">
    <div class="doc-nav-header">
      <h3 class="doc-nav-title">{{ doc_title }}</h3>
      <button class="doc-nav-close" aria-label="Close documentation navigation">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </button>
    </div>
    <div class="doc-nav-scroll-area">
      {{ nav_list_html }}
    </div>
  </aside>
  <article id="doc-content" class="article article--doc content typeset js-toc-content">
    <!-- MODIFICATION HERE: Use `show_toc` instead of `page.toc` -->
    {% if show_toc %}
    <div id="toc-middle-container" class="toc-middle-container">
      <h3 class="toc-title">Index</h3>
      <div class="js-toc-middle"></div>
    </div>
    {% endif %}
    {{ content }}
  </article>
  <!-- MODIFICATION HERE: Use `show_toc` instead of `page.toc` -->
  {% if show_toc %}
  <aside class="content-toc-right-wrapper">
    <div id="toc-right-container">
      <h3 class="toc-title">Index</h3>
      <div class="js-toc-right"></div>
    </div>
  </aside>
  {% else %}
  <aside class="placeholder-toc" aria-hidden="true"></aside>
  {% endif %}
</main>

<!-- All JavaScripts remain unchanged -->
<script>/* DocNavController script (unchanged) */ document.addEventListener('DOMContentLoaded',function(){const e={SCROLL_STORAGE_KEY:"docNavScrollPos",EXPAND_STORAGE_KEY:"docNavExpandedItems",body:document.body,fab:document.querySelector(".doc-nav-fab"),overlay:document.querySelector(".doc-nav-overlay"),navContainer:document.querySelector(".doc-nav-container"),closeButton:document.querySelector(".doc-nav-close"),scrollArea:document.querySelector(".doc-nav-scroll-area"),init:function(){this.navContainer&&(this.setupMobileHeight(),this.applyStoredState(),this.bindEvents())},applyStoredState:function(){const e=JSON.parse(sessionStorage.getItem(this.EXPAND_STORAGE_KEY));e?document.querySelectorAll(".doc-nav-item[data-url]").forEach(t=>{e.includes(t.dataset.url)&&t.classList.add("is-expanded")}):document.querySelectorAll(".doc-nav-item--l1[data-url]").forEach(e=>{e.classList.add("is-expanded")});const t=sessionStorage.getItem(this.SCROLL_STORAGE_KEY);t&&this.scrollArea&&(this.scrollArea.scrollTop=parseInt(t,10))},saveState:function(){if(!this.scrollArea)return;sessionStorage.setItem(this.SCROLL_STORAGE_KEY,this.scrollArea.scrollTop);const e=[];document.querySelectorAll(".doc-nav-item.is-expanded[data-url]").forEach(t=>{e.push(t.dataset.url)}),sessionStorage.setItem(this.EXPAND_STORAGE_KEY,JSON.stringify(e))},bindEvents:function(){this.fab&&this.fab.addEventListener("click",this.openNav.bind(this)),this.overlay&&this.overlay.addEventListener("click",this.closeNav.bind(this)),this.closeButton&&this.closeButton.addEventListener("click",this.closeNav.bind(this)),this.navContainer.addEventListener("click",e=>{const t=e.target.closest(".doc-nav-toggle-wrapper");t&&(t.closest(".doc-nav-item").classList.toggle("is-expanded"),this.saveState());const o=e.target.closest(".doc-nav-link");o&&this.saveState()}),window.addEventListener("resize",this.debounce(this.setupMobileHeight.bind(this),150))},openNav:function(){this.body.classList.add("doc-nav-open")},closeNav:function(){this.body.classList.remove("doc-nav-open")},setupMobileHeight:function(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),document.documentElement.style.setProperty("--doc-nav-dynamic-height",`${window.innerHeight}px`)},debounce:function(e,t){let o;return function(...s){const n=()=>{clearTimeout(o),e.apply(this,s)};clearTimeout(o),o=setTimeout(n,t)}}};e.init()});</script>
<script>/* Image path script (unchanged) */ document.addEventListener('DOMContentLoaded',function(){const e="{{ page.collection }}";if(!e)return;const t=`/uploads/${e}/`,o=document.querySelector(".article--doc");if(!o)return;o.querySelectorAll("img").forEach(e=>{const o=e.getAttribute("src");if(o&&o.startsWith("./")){const s=o.substring(2),n=t+s;e.setAttribute("src",n)}})});</script>

{% include tts-reader.html %}
{% include content-toc.html %}
{% include site-footer.html %}