---
layout: default
---

{%- comment %}
  ============================================================================
  PART 1: DATA PREPARATION (Jekyll/Liquid)
  ============================================================================
  - 检查是否需要生成右侧的章节TOC (Tocbot)。
  - 获取当前 collection 的信息，并对其文档进行排序，用于生成左侧导航。
{%- endcomment %}

{%- comment %} --- 右侧章节目录 (Tocbot) 的数据准备 --- {% endcomment %}
{%- assign has_right_toc = false -%}
{%- assign right_toc_html = "" -%}

{%- if page.toc == true and (content contains '<h2' or content contains '<h3' or content contains '<h4') -%}
  {%- capture captured_toc -%}{% include toc.html content=content %}{%- endcapture -%}
  {%- assign toc_trimmed = captured_toc | strip -%}
  {%- if toc_trimmed != "" -%}
    {%- assign has_right_toc = true -%}
    {%- assign right_toc_html = captured_toc -%}
  {%- endif -%}
{%- endif -%}

{%- comment %} --- 左侧书籍导航的数据准备 --- {% endcomment %}
{%- assign collection_name = page.collection -%}
{%- assign collection_docs = site[collection_name] | sort: 'order' -%}
{%- assign collection_title = collection_name | capitalize -%}


{%- comment %}
  ============================================================================
  PART 2: INLINE CSS
  ============================================================================
  - 定义三栏布局：左侧书籍导航，中间内容，右侧章节目录。
  - 使用 modifier class `.has-right-toc` 来动态切换两栏/三栏布局。
{%- endcomment %}
<style>
  /* --- DOC LAYOUT STYLES --- */

  /* 1. 主布局: 在宽屏上使用 Flexbox */
  @media screen and (min-width: 1200px) { /* 三栏布局需要更宽的屏幕 */
    .main.container--doc {
      position: relative;
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 2.5em; /* 栏间距 */
    }
  }

  /* 2. 左侧边栏: 书籍导航 */
  .doc-nav-container {
    display: none; /* 移动端默认隐藏 */
  }
  @media screen and (min-width: 1200px) {
    .doc-nav-container {
      display: block;
      flex: 0 0 280px; /* 左侧导航固定宽度 */
      position: sticky;
      top: 2rem;
      align-self: flex-start;
      max-height: calc(100vh - 4rem);
      overflow-y: auto;
      background-color: #f5f5f5; /* 灰色背景 */
      padding: 1.5em;
      border-radius: 8px;
    }
    .doc-nav-container h3 {
      margin-top: 0;
      margin-bottom: 1em;
      font-size: 1.2em;
      font-weight: 700;
      color: #2c3e50;
    }
    .doc-nav-container ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .doc-nav-container li a {
      display: block;
      padding: 8px 12px;
      text-decoration: none;
      color: #555;
      border-radius: 4px;
      transition: background-color 0.2s, color 0.2s;
      font-size: 0.9em;
      line-height: 1.4;
    }
    .doc-nav-container li a:hover {
      background-color: #e9e9e9;
      color: #000;
    }
    /* 当前活动页面的链接样式 */
    .doc-nav-container li.active a {
      background-color: #3a77d8; /* 主题色 */
      color: #fff;
      font-weight: 600;
    }
  }

  /* 3. 中间内容区 */
  .article--doc {
    flex: 1 1 auto;
    min-width: 0; /* 防止内容过长时撑破布局 */
  }
  
  /* 4. 右侧边栏: 章节目录 (Tocbot) */
  .doc-chapter-toc {
    display: none; /* 默认隐藏 */
  }
  /* 仅在 .has-right-toc 容器内且为宽屏时显示 */
  @media screen and (min-width: 1200px) {
    .main.container--doc.has-right-toc .doc-chapter-toc {
      display: block;
      flex: 0 0 260px; /* 右侧 TOC 固定宽度 */
      position: sticky;
      top: 2rem;
      align-self: flex-start;
      max-height: calc(100vh - 4rem);
      overflow-y: auto;
    }
  }

  /* 5. Tocbot 核心样式 (与 post.html 保持一致) */
  .doc-chapter-toc h3 { margin-top: 0; margin-bottom: 1em; font-size: 1.1em; font-weight: 600; color: #333; }
  .toc { overflow-y: auto; }
  .toc-list { margin: 0; padding: 0; list-style-type: none; }
  .toc-list-item { margin-bottom: 5px; }
  .toc-link { display: block; padding: 4px 10px; border-left: 2px solid #EEE; color: #777; text-decoration: none; font-size: 0.875em; line-height: 1.5; transition: all 0.2s ease-in-out; }
  .toc-link:hover { color: #333; border-left-color: #AAA; }
  .is-active-link { color: #007bff; font-weight: 600; border-left-color: #007bff; background-color: #f0f7ff; }
  .toc-list .toc-list { padding-left: 1.25em; }

  /* 6. 移动端 TOC 容器 (与 post.html 保持一致) */
  .toc-mobile-container { display: block; margin: 2em 0; padding: 1em; border: 1px solid #eee; border-radius: 4px; background-color: #f9f9f9; }
  .toc-mobile-container h3 { margin-top: 0; }
  @media screen and (min-width: 1200px) {
    .toc-mobile-container { display: none; }
  }
</style>

{% include site-header.html %}

<!-- 根据是否存在右侧TOC，给 main 标签添加一个 class，用于CSS选择 -->
<main class="main container container--doc {% if has_right_toc %}has-right-toc{% endif %}">
  
  {%- comment %}
    ============================================================================
    PART 3: HTML STRUCTURE
    ============================================================================
    - 左侧: 书籍导航
    - 中间: 文章内容
    - 右侧: 章节目录 (条件性显示)
  {%- endcomment %}

  <!-- Left Sidebar: Book Navigation -->
  {% if collection_name %}
  <aside class="doc-nav-container">
    <h3>{{ collection_title }}</h3>
    <ul>
      {% for doc in collection_docs %}
        <li {% if page.url == doc.url %}class="active"{% endif %}>
          <a href="{{ doc.url | relative_url }}">{{ doc.title }}</a>
        </li>
      {% endfor %}
    </ul>
  </aside>
  {% endif %}

  <!-- Center: Main article content -->
  <article class="article article--doc content typeset js-toc-content">
    <h1>{{ page.title }}</h1>
    
    <!-- 移动端TOC的锚点，JS会把TOC插入到这里 -->
    {% if has_right_toc %}<div id="mobile-toc-anchor"></div>{% endif %}

    {{ content }}

  </article>

  <!-- Right Sidebar: Chapter TOC (Tocbot) -->
  {% if has_right_toc %}
  <aside class="doc-chapter-toc">
    <h3>本章目录</h3>
    <!-- Tocbot 将会填充这个 div -->
    <div class="js-toc">
        {{ right_toc_html }}
    </div>
  </aside>
  {% endif %}

</main>

{% include site-footer.html %}


{%- comment %}
  ============================================================================
  PART 4: JAVASCRIPT LOGIC
  ============================================================================
  - 只有在 `has_right_toc` 为 true 时才加载和执行 Tocbot 脚本。
  - JS 断点与 CSS 保持一致 (1200px)。
{%- endcomment %}
{% if has_right_toc %}
<!-- 1. 仅在需要时加载 Tocbot 库 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.27.18/tocbot.min.js"></script>

<!-- 2. 初始化 Tocbot 或处理移动端视图 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const desktopBreakpoint = 1200; // 必须与 CSS 中的断点匹配
  const isDesktop = window.innerWidth >= desktopBreakpoint;

  if (isDesktop && document.querySelector('.js-toc')) {
    // === 桌面端: 初始化 Tocbot ===
    tocbot.init({
      tocSelector: '.js-toc',
      contentSelector: '.js-toc-content',
      headingSelector: 'h2, h3, h4',
      hasInnerContainers: true,
      scrollSmooth: true,
      scrollSmoothOffset: -80, // 如果你有固定的顶部导航，这里可以设置偏移
    });
  } else {
    // === 移动端: 注入原始的 TOC HTML ===
    const mobileAnchor = document.getElementById('mobile-toc-anchor');
    const rawTocHtml = document.querySelector('.js-toc')?.innerHTML;

    if (mobileAnchor && rawTocHtml) {
      const mobileWrapper = document.createElement('div');
      mobileWrapper.className = 'toc-mobile-container';
      mobileWrapper.innerHTML = `<h3>本章目录</h3><div class="toc-content-wrapper">${rawTocHtml}</div>`;
      
      // 插入到锚点之后
      mobileAnchor.parentNode.insertBefore(mobileWrapper, mobileAnchor.nextSibling);
      // 移除锚点
      mobileAnchor.parentNode.removeChild(mobileAnchor);
    }
  }
});
</script>
{% endif %}