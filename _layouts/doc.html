---
layout: default
---

{%- comment %} --- Data Preparation --- {% endcomment %}
{%- assign collection_name = page.collection -%}
{%- assign doc_data = site.data.docs[collection_name] -%}
{%- assign doc_title = doc_data.title | default: collection_name | capitalize -%}
{%- assign doc_chapters = doc_data.chapters -%}
{%- assign page_title_from_data = "" -%}
{%- for chapter in doc_chapters -%}{%- if chapter.url == page.url -%}{%- assign page_title_from_data = chapter.title -%}{% break %}{%- endif -%}{%- if chapter.subitems -%}{%- for subitem in chapter.subitems -%}{%- if subitem.url == page.url -%}{%- assign page_title_from_data = subitem.title -%}{% break %}{%- endif -%}{%- if subitem.subitems -%}{%- for subsubitem in subitem.subitems -%}{%- if subsubitem.url == page.url -%}{%- assign page_title_from_data = subsubitem.title -%}{% break %}{%- endif -%}{%- endfor -%}{%- if page_title_from_data != "" %}{% break %}{% endif %}{%- endif -%}{%- endfor -%}{%- if page_title_from_data != "" %}{% break %}{% endif %}{%- endif -%}{%- endfor -%}
{%- assign page_title_to_display = page_title_from_data | default: page.title | default: "Untitled" -%}
{%- capture nav_list_html %}<ul>{%- for item_l1 in doc_chapters %}<li class="{% if page.url == item_l1.url %}active{% endif %}"><a href="{{ item_l1.url | relative_url }}">{{ item_l1.title }}</a>{%- if item_l1.subitems %}<ul>{%- for item_l2 in item_l1.subitems %}<li class="{% if page.url == item_l2.url %}active{% endif %}"><a href="{{ item_l2.url | relative_url }}">{{ item_l2.title }}</a>{%- if item_l2.subitems %}<ul>{%- for item_l3 in item_l2.subitems %}<li class="{% if page.url == item_l3.url %}active{% endif %}"><a href="{{ item_l3.url | relative_url }}">{{ item_l3.title }}</a></li>{%- endfor %}</ul>{%- endif %}</li>{%- endfor %}</ul>{%- endif %}</li>{%- endfor %}</ul>{%- endcapture %}

<style>
  /* --- Layout-specific styles for DOC --- */
  .doc-nav-container { display: none; }
  .doc-nav-fab { position: fixed; bottom: 30px; left: 30px; width: 56px; height: 56px; background-color: #2c3e50; color: white; border-radius: 50%; border: none; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); cursor: pointer; z-index: 1001; }

  /* ★ 新增：调整左侧导航字号 ★ */
  .doc-nav-container a { font-size: 14px; }
  
  /* 2-column */
  @media screen and (min-width: 768px) {
    .doc-nav-mobile-container { display: none; }
    .main.container--doc { display: flex; gap: 2em; max-width: 960px; margin: 0 auto; align-items: flex-start; }
    .doc-nav-container { display: block; flex: 0 0 260px; position: sticky; top: 2rem; max-height: calc(100vh - 4rem); }
    .article--doc { flex: 1 1 auto; min-width: 0; }
  }
  /* 3-column */
  @media screen and (min-width: 1200px) {
    .main.container--doc { max-width: 1440px; gap: 2.5em; justify-content: center; }
    .doc-nav-container { flex-basis: 280px; }
    .article--doc { flex-grow: 1; flex-basis: auto; max-width: 800px; }
    .main.container--doc .content-toc-right-wrapper { display: block; flex: 0 0 260px; position: sticky; top: 2rem; max-height: calc(100vh - 4rem); overflow-y: auto; }
  }
  /* Ultra-wide */
  @media screen and (min-width: 1800px) {
    .main.container--doc { max-width: 2200px; width: 90%; justify-content: space-between; }
    .doc-nav-container { flex: 0 0 300px; }
    .article--doc { flex: 0 0 800px; }
    .main.container--doc .content-toc-right-wrapper { flex: 0 0 280px; }
  }
</style>

{% include site-header.html %}

<main class="main container container--doc {% if page.toc %}has-right-toc{% endif %}">
  
  <aside class="doc-nav-container">
    <div class="doc-nav-scroll-area">
      <h3>{{ doc_title }}</h3>
      {{ nav_list_html }}
    </div>
  </aside>

  <article class="article article--doc content typeset js-toc-content">
    <h1>{{ page_title_to_display }}</h1>
    
    {% if page.toc %}
    <div id="toc-middle-container" class="toc-middle-container">
      <h3 class="toc-title">Index</h3>
      <div class="js-toc-middle"></div>
    </div>
    {% endif %}

    <div class="content-body">
      {{ content }}
    </div>
  </article>

  {% if page.toc %}
  <aside class="content-toc-right-wrapper">
    <div id="toc-right-container">
      <h3 class="toc-title">Index</h3>
      <div class="js-toc-right"></div>
    </div>
  </aside>
  {% endif %}

</main>

{% include site-footer.html %}

<!-- ★ 新增：恢复图片路径修复脚本 ★ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const collectionName = '{{ page.collection }}';
  if (!collectionName) { return; }
  const assetBasePath = `/uploads/${collectionName}/`;
  const contentArea = document.querySelector('.article--doc');
  if (!contentArea) { return; }
  const images = contentArea.querySelectorAll('img');
  images.forEach(img => {
    const originalSrc = img.getAttribute('src');
    if (originalSrc && originalSrc.startsWith('./')) {
      const relativePath = originalSrc.substring(2);
      const newSrc = assetBasePath + relativePath;
      img.setAttribute('src', newSrc);
    }
  });
});
</script>

{% include content-toc.html %}