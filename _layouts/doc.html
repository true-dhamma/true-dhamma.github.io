---
layout: default
---

{%- comment %}
  ============================================================================
  PART 1: DATA PREPARATION (Jekyll/Liquid) (高兼容性版)
  ============================================================================
{%- endcomment %}
{%- assign collection_name = page.collection -%}
{%- assign collection_title = collection_name | capitalize -%}

{%- comment %} 提取页面标题 (高兼容性版) {% endcomment %}
{% assign content_lines = page.content | split: "
" %}
{% assign first_line_with_content = "" %}
{% assign page_title = "" %}
{% for line in content_lines %}
  {% assign stripped_line = line | strip %}
  {% if stripped_line.size > 0 %}
      {% assign first_char = stripped_line | slice: 0 %}
      {% if first_char == "#" %}
        {% assign page_title = stripped_line | remove_first: "#### " | remove_first: "### " | remove_first: "## " | remove_first: "# " | strip %}
        {% assign first_line_with_content = line %}
        {% break %}
      {% endif %}
  {% endif %}
{% endfor %}

{%- comment %} --- 右侧章节目录 (Tocbot) 的数据准备 (高兼容性版) --- {% endcomment %}
{%- assign has_right_toc = false -%}
{%- assign right_toc_html = "" -%}
{%- if page.toc == true -%}
  {%- if page.content contains '<h2' or page.content contains '<h3' or page.content contains '<h4' -%}
    {%- capture captured_toc -%}{% include toc.html content=page.content %}{%- endcapture -%}
    {%- assign toc_trimmed = captured_toc | strip -%}
    {%- if toc_trimmed != "" -%}
      {%- assign has_right_toc = true -%}
      {%- assign right_toc_html = captured_toc -%}
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

{%- comment %}
  ============================================================================
  PART 2: INLINE CSS (无变动)
  ============================================================================
{%- endcomment %}
<style>
  :root {
    --doc-nav-accent: #3a77d8;
    --doc-nav-text: #343a40;
    --doc-nav-text-subtle: #6c757d;
    --doc-nav-bg-hover: #e9ecef;
    --doc-nav-ancestor-bg: rgba(58, 119, 216, 0.08);
  }
  @media screen and (min-width: 1200px) {
    .main.container--doc { position: relative; display: flex; align-items: flex-start; gap: 2.5em; }
    .article--doc { flex: 1 1 auto; min-width: 0; }
  }
  @media screen and (min-width: 1600px) {
    .main.container--doc { max-width: 1400px; margin-left: auto; margin-right: auto; }
  }
  .doc-nav-container { display: none; }
  @media screen and (min-width: 1200px) {
    .doc-nav-container {
      display: block; flex: 0 0 280px; position: sticky; top: 2rem;
      max-height: calc(100vh - 4rem); font-size: 16px;
    }
    .doc-nav-scroll-area {
      height: 100%; overflow-y: auto; padding-right: 1em;
    }
    .doc-nav-container h3 {
      margin: 0 0 1em; font-size: 1.4em; font-weight: 700; color: var(--doc-nav-text);
    }
    .doc-nav-container ul, .doc-nav-container li { list-style: none; padding: 0; margin: 0; }
    .doc-nav-container ul { position: relative; }
    .doc-nav-container ul ul { margin-left: 20px; }
    .doc-nav-container a {
      display: block; text-decoration: none; padding: 8px 12px;
      border-radius: 6px; color: var(--doc-nav-text-subtle);
      line-height: 1.5; transition: all 0.2s ease;
      border-left: 3px solid transparent;
    }
    .doc-nav-container a:hover {
      color: var(--doc-nav-text); background-color: var(--doc-nav-bg-hover);
    }
    .doc-nav-container li.is-ancestor > a {
      color: var(--doc-nav-text); background-color: var(--doc-nav-ancestor-bg);
    }
    .doc-nav-container li.is-active > a {
      color: var(--doc-nav-accent); font-weight: 600;
      border-left-color: var(--doc-nav-accent);
    }
  }
  @media screen and (min-width: 1600px) {
    .doc-nav-container { flex-basis: 320px; }
  }
  .doc-nav-fab {
    position: fixed; bottom: 30px; left: 20px;
    width: 56px; height: 56px;
    background-color: #ffffff; color: #495057;
    border-radius: 50%; border: 1px solid #dee2e6;
    display: flex; justify-content: center; align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    cursor: pointer; z-index: 1001;
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease;
  }
  .doc-nav-fab:hover { transform: scale(1.05); box-shadow: 0 6px 16px rgba(0,0,0,0.12); }
  .doc-nav-fab .icon { width: 24px; height: 24px; fill: currentColor; }
  .doc-nav-mobile-menu {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: #f8f9fa; color: var(--doc-nav-text);
    z-index: 1002;
    transform: translateX(-100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex; flex-direction: column;
  }
  .doc-nav-mobile-menu.is-open { transform: translateX(0); }
  .doc-nav-mobile-header {
    flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;
    padding: 1rem 1.5rem; border-bottom: 1px solid #dee2e6;
  }
  .doc-nav-mobile-header h3 { font-size: 1.2rem; margin: 0; }
  .doc-nav-mobile-close {
    background: none; border: none; cursor: pointer; padding: 8px;
    color: var(--doc-nav-text-subtle);
  }
  .doc-nav-mobile-close:hover { color: var(--doc-nav-text); }
  .doc-nav-mobile-menu .doc-nav-scroll-area {
    flex-grow: 1; overflow-y: auto; padding: 1rem 1.5rem;
  }
  .doc-nav-mobile-menu ul, .doc-nav-mobile-menu li { list-style:none; margin:0; padding:0; }
  .doc-nav-mobile-menu ul ul { margin-left: 20px; }
  .doc-nav-mobile-menu a {
    padding: 12px 10px; display:block; text-decoration: none;
    font-size: 1.1rem; color: var(--doc-nav-text-subtle);
  }
  .doc-nav-mobile-menu li.is-ancestor > a { color: var(--doc-nav-text); }
  .doc-nav-mobile-menu li.is-active > a { color: var(--doc-nav-accent); font-weight: 600; }
  @media screen and (min-width: 1200px) {
    .doc-nav-fab, .doc-nav-mobile-menu { display: none; }
  }
  .doc-chapter-toc { display: none; }
  @media screen and (min-width: 1200px) {
    .main.container--doc.has-right-toc .doc-chapter-toc {
      display: block; flex: 0 0 260px; position: sticky; top: 2rem;
      max-height: calc(100vh - 4rem); overflow-y: auto;
    }
  }
  .doc-chapter-toc h3 { margin: 0 0 1em; font-size: 1.1em; font-weight: 600; color: #333; }
  .toc-list { margin:0; padding:0; list-style:none; }
  .toc-link { display: block; padding: 4px 10px; border-left: 2px solid #EEE; color: #777; text-decoration: none; font-size: 0.875em; line-height: 1.5; transition: all 0.2s ease-in-out; }
  .is-active-link { color: #007bff; font-weight: 600; border-left-color: #007bff; background-color: #f0f7ff; }
  .toc-list .toc-list { padding-left: 1.25em; }
  .toc-mobile-container { margin: 2em 0; padding: 1em; border: 1px solid #eee; border-radius: 4px; background-color: #f9f9f9; }
  .toc-mobile-container h3 { margin-top: 0; }
  @media screen and (min-width: 1200px) { .toc-mobile-container { display: none; } }
</style>

{%- comment %}
  ============================================================================
  PART 3: HTML STRUCTURE
  ============================================================================
{%- endcomment %}

{% include site-header.html %}

<main class="main container container--doc {% if has_right_toc %}has-right-toc{% endif %}">
  
  <aside id="doc-nav-desktop-container" class="doc-nav-container">
    <div class="doc-nav-scroll-area">
      <h3>{{ collection_title }}</h3>
      {% include build-nav-tree.html collection=collection_name %}
    </div>
  </aside>

  <article class="article article--doc content typeset js-toc-content">
    <h1>{{ page_title }}</h1>
    {% if has_right_toc %}<div id="mobile-toc-anchor"></div>{% endif %}
    
    {{ page.content | remove_first: first_line_with_content }}
  </article>

  {% if has_right_toc %}
  <aside class="doc-chapter-toc">
    <h3>本章目录</h3>
    <div class="js-toc">{{ right_toc_html }}</div>
  </aside>
  {% endif %}
</main>

<div class="doc-nav-mobile-container">
  <nav id="doc-nav-mobile-menu" class="doc-nav-mobile-menu">
    <div class="doc-nav-mobile-header">
      <h3>{{ collection_title }}</h3>
      <button id="doc-nav-mobile-close" class="doc-nav-mobile-close" aria-label="关闭目录">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </button>
    </div>
    <div class="doc-nav-scroll-area">
      {% include build-nav-tree.html collection=collection_name %}
    </div>
  </nav>
  <button id="doc-nav-fab" class="doc-nav-fab" aria-label="打开目录">
    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 5v14a1 1 0 0 1-1 1H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h11a1 1 0 0 1 1 1zM8 7a1 1 0 0 0-1 1v10h10V7H8z"></path><path d="M17.5 17a.5.5 0 0 0 .5-.5V7a.5.5 0 0 0-1 0v9.5a.5.5 0 0 0 .5.5z"></path></svg>
  </button>
</div>

{% include site-footer.html %}

{%- comment %}
  ============================================================================
  PART 4: JAVASCRIPT LOGIC (无变动)
  ============================================================================
{%- endcomment %}
<!-- 1. Tocbot JS (条件性加载) -->
{% if has_right_toc %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.27.18/tocbot.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  if (window.innerWidth >= 1200 && document.querySelector('.js-toc')) {
    tocbot.init({ tocSelector: '.js-toc', contentSelector: '.js-toc-content', headingSelector: 'h2, h3, h4', hasInnerContainers: true, scrollSmooth: true, scrollSmoothOffset: -80 });
  } else {
    const mobileAnchor = document.getElementById('mobile-toc-anchor');
    const rawTocHtml = document.querySelector('.js-toc')?.innerHTML;
    if (mobileAnchor && rawTocHtml) {
      const mobileWrapper = document.createElement('div');
      mobileWrapper.className = 'toc-mobile-container';
      mobileWrapper.innerHTML = `<h3>本章目录</h3><div class="toc-content-wrapper">${rawTocHtml}</div>`;
      mobileAnchor.parentNode.insertBefore(mobileWrapper, mobileAnchor.nextSibling);
      mobileAnchor.parentNode.removeChild(mobileAnchor);
    }
  }
});
</script>
{% endif %}

<!-- 2. Navigation Tree Builder & Mobile Menu JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    function buildNavTree(container) {
        const list = container.querySelector('ul');
        if (!list) return;

        const allItems = Array.from(list.children);
        const parentStack = [list];

        allItems.forEach(item => {
            const level = parseInt(item.dataset.level, 10);
            
            while (level < parentStack.length) {
                parentStack.pop();
            }
            
            if (level > parentStack.length) {
                const newUl = document.createElement('ul');
                const lastLi = parentStack[parentStack.length - 1].lastElementChild;
                if (lastLi) {
                    lastLi.appendChild(newUl);
                    parentStack.push(newUl);
                }
            }
            
            // It's crucial to append the original item, not a clone
            parentStack[parentStack.length - 1].appendChild(item);
        });
    }

    const desktopNav = document.getElementById('doc-nav-desktop-container');
    const mobileNav = document.getElementById('doc-nav-mobile-menu');

    if (desktopNav) buildNavTree(desktopNav);
    if (mobileNav) buildNavTree(mobileNav);

    const fab = document.getElementById('doc-nav-fab');
    const menu = document.getElementById('doc-nav-mobile-menu');
    const closeBtn = document.getElementById('doc-nav-mobile-close');

    if (!fab || !menu || !closeBtn) return;

    function openMenu() {
        menu.classList.add('is-open');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        menu.classList.remove('is-open');
        document.body.style.overflow = '';
    }

    fab.addEventListener('click', openMenu);
    closeBtn.addEventListener('click', closeMenu);
    menu.addEventListener('click', function(event) {
        if (event.target.tagName === 'A') { closeMenu(); }
    });
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && menu.classList.contains('is-open')) { closeMenu(); }
    });
});
</script>